---
title: javascript基础(七)-操作符
date: 2019-06-4 11:30:43
tags: js
categories: js
---

> 本文译自[operators](https://javascript.info/operators)

上学的时候我们知道了很多操作符，比如加`+`，减`-`，乘`*`等等。
本节，我们将集中讨论学校算术没有涉及到的运算符。

## 术语
首先，让我们先掌握一些常用的术语。
* 操作数————运算符的应用对象。比如：在乘法`5*2`中有2个操作数：左边操作数是5，右边操作数是2，有时，人们称这些为“参数”而不是“操作数”。
* 如果一个操作符只有一个操作数，那么它就是一元的。例如，一元否定，反转数字的符号-:

```javascript
let x = 1;

x = -x;
alert( x ); // -1, 应用了一元否定
```

* 如果一个操作符有两个操作数，那么它就是二元的。同样的负号也以二元形式存在:

```javascript
let x = 1, y = 3;
alert( y - x ); // 2, 二元减法
```

形式上，我们在这里讨论的是两个不同的操作符:一元否定(单操作数:反转符号)和二元减法(两个操作数:减法)。

## 字符串连接，二元+
现在，让我们看看JavaScript操作符的一些特殊特性，它们超出了学校算术的范围。
通常，加号`+`取数字的和，但如果二元操作符`+`是用在字符串上，则是连接它们：

```javascript
let s = "my" + "string";
alert(s); // mystring
```

注意，如果其中的一个操作数是字符串，那么另外一个也会被转成字符串。
举个例子：

```javascript
alert( '1' + 2 ); // "12"
alert( 2 + '1' ); // "21"
```

看，不管第一个还是第二个操作数哪个是字符串，规则很简单：如果有一个操作数是字符串，另外一个也会转成字符串。
不过需要注意，操作是从左到右运行的，如果字符串前面有2个数字，前面的数字会先相加，然后再转成字符串：

```javascript
alert(2 + 2 + '1' ); // "41" and not "221"
```

二元操作符`+`对字符串连接和转换比较特殊。其他算术运算符只处理数字，并且总是将它们的操作数转换为数字。
比如减法和除法：

```javascript
alert( 2 - '1' ); // 1
alert( '6' / '2' ); // 3
```

## 数值转换，一元+
`+`号有两种存在形式：上面用到的二元形式和下面的一元形式。
一元加，换个词，加号`+`用到单个值，不会对数字做什么，但如果操作数不是数字，一元加会把它转成数字。
举个例子：

```javascript
// 对数字没有影响
let x = 1;
alert( +x ); // 1

let y = -2;
alert( +y ); // -2

// 非数字转换成数字
alert( +true ); // 1
alert( +"" );   // 0
```

它和`Number(...)`做一样的事情，但是更简短。
将字符串转换为数字的需求经常出现。例如，如果我们从HTML表单字段获取值，它们通常是字符串。
如果我们要把它们加起来呢?
二进制加号将它们作为字符串相加:

```javascript
let apples = "2";
let oranges = "3";

alert( apples + oranges ); // "23", 加号连接字符串
```

如果想把它们看成数字，需要把它们转换成数字，然后才能求和:

```javascript
let apples = "2";
let oranges = "3";

// 相加之前两个值都转换成了数字
alert( +apples + +oranges ); // 5

// 长一点的写法
// alert( Number(apples) + Number(oranges) ); // 5
```

从数学家的角度来看，加号的数量之多似乎有些奇怪。但是从程序员的角度来看，没有什么特别的:首先应用一元加号，它们将字符串转换为数字，然后二进制加号将它们相加。
为什么一元加号应用先于二元加号?我们会看到，这是因为它们的优先级更高。

## 运算符优先级
如果表达式有多个运算符，则执行顺序由它们的优先级定义，或者换句话说，由运算符的隐式优先级顺序定义。
上学的时候我们都知道，算式`1+2*2`里面，会先乘再加，这就是优先级。乘法的优先级比加法高。
括号覆盖任何优先级，因此如果我们不满意隐式顺序，可以使用它们来更改它。比如：`(1 + 2) * 2`。
JavaScript中有很多操作符。每个运算符都有一个对应的优先号。数字较大的先执行。如果优先级相同，则执行顺序从左到右。
下面是[优先表](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)的摘录(你不需要记住这个，但是注意一元运算符比对应的二元运算符高):

|优先级|名称|符号|
| :--------: | :-----: | :-----: |
| ... | ... | ... |
| 16 | 一元加 | + |
| 16 | 一元减 | + |
| 14 | 乘 | * |
| 14 | 除 | / |
| 13 | 加 | + |
| 13 | 减 | - |
| ... | ... | ... |
| 3 | 赋值 | = |
| ... | ... | ... |

## 赋值
注意赋值符号`=`也是运算符，在上面的优先级表中可以看到它优先级很低，只有3.
这就是为什么我们申明一个变量，比如`x = 2 * 2 + 1`，会先做运算，然后才把结果赋值给x去存储。

```javascript
let x = 2 * 2 + 1;

alert( x ); // 5
```

也可以链式赋值

```javascript
let a, b, c;

a = b = c = 2 + 2;

alert( a ); // 4
alert( b ); // 4
alert( c ); // 4
```

链式赋值从右到左运算，首先计算最后边的`2+2`，然后赋值给左侧的变量c,b和a,最后所有的变量共享一个值。

操作符通常会有返回值，最明显的比如加号`+`或者乘号`*`，这里的赋值运算符也是如此。
`x = value`把`value`值写进`x`然后返回value值。
下面是一个使用赋值作为更复杂表达式的一部分的demo:

```javascript
let a = 1;
let b = 2;

let c = 3 - (a = b + 1);

alert( a ); // 3
alert( c ); // 0
```

上面的例子中，`(a = b + 1)`的结果是赋值给a的值3，然后用3来减它。
是不是很有意思的代码？我们需要理解它，因为有时会在第三方库中看到，但是我们自己不应该这样写，这使代码不够简洁且不便于阅读。

## 余数%
余数操作符%尽管出现了，但与百分比无关。`a % b`的结果是a除以b的整数的余数。

```javascript
alert( 5 % 2 ); // 1是5除2的余数
alert( 8 % 3 ); // 2是8除3的余数
alert( 6 % 3 ); // 0是6除3的余数
```

## 取幂**
取幂操作符**是最近添加到语言中的。自然数b，`a**b`的结果是a乘以自己b次。

```javascript
alert( 2 ** 2 ); // 4  (2 * 2)
alert( 2 ** 3 ); // 8  (2 * 2 * 2)
alert( 2 ** 4 ); // 16 (2 * 2 * 2 * 2)
```

取幂操作符也可以应用到非整数上：
```javascript
alert( 4 ** (1/2) ); // 2 (1/2的幂等于平方根，这就是数学)
alert( 8 ** (1/3) ); // 2 (1/3的幂等于一个立方根)
```

## 自增/自减
将一个数增加或减少一是最常见的数值运算之一。
所以，它有特殊的运算符:
* 自增`++`使变量自增1
```javascript
let counter = 2;
counter++;      // 和counter = counter + 1一样,但更短
alert( counter ); // 3
```

* 自减`++`使变量自减1
```javascript
let counter = 2;
counter++;      // 和counter = counter - 1一样,但更短
alert( counter ); // 1
```

<div class="tip">
`++`和`--`只能用到变量上，类似5++这样的用法会报错。
</div>

`++`和`--`可以放在变量前面或者后面。
* 放在变量后面时，是后缀形式：`counter++`。
* 放在变量前面时，是前缀形式：`++counter`。

这两种形式都做同样的事情:让counter加1.
有什么不同吗？有的。不过这要看我们是否使用`++/--`的返回值。

说明白点就是，所有的操作符都有返回值，`++/--`也不例外，前缀形式返回新值，后缀形式返回旧值：
```javascript
let counter = 1;
let a = ++counter; // (*)

alert(a); // 2
```

在第(*)行，前缀形式`++counter`使counter加1，并返回新值2，所以`alert`显示2。
现在我们看看后缀形式：
```javascript
let counter = 1;
let a = counter++; // (*)

alert(a); // 1
```

在第(*)行，后缀形式`counter++`使counter加1，但是返回旧值1，所以`alert`显示1。

总结：
* 如果不用`++/--`的返回值，他们没有区别：
```javascript
let counter = 0;
counter++;
++counter;
alert( counter ); // 2
```

* 如果我们要使变量值加1并且立刻使用操作后的值，就需要用前缀形式：
```javascript
let counter = 0;
alert( ++counter ); // 1
```

* 如果我们使变量加1，但是想用它加1之前的值，就需要用后缀形式：
```javascript
let counter = 0;
alert( counter++ ); // 0
```
### 优先级
`++/--`也可以用在表达式里面，他们的优先级高于大多数其他算术操作符。
```javascript
let counter = 1;
alert( 2 * ++counter ); // 4
```

```javascript
let counter = 1;
alert( 2 * counter++ ); // 2, counter++返回旧值
```

虽然这种写法没有错误，但是使代码可读性变差，一行做多个事情并不好，
读代码时，快速“垂直”浏览很容易就忽视了`counter++`，并且它让变量增加的操作不够明显。
我们推荐“一行————一个操作”的风格：
```javascript
let counter = 1;
alert( 2 * counter );
counter++;
```

## 按位运算符
位操作符将参数视为32位整数，并在其二进制级别上工作。
这些操作符不是javascript特有的，大多数编程语言都支持：

* 与 AND ( & )
* 或 OR ( | )
* 异或 XOR ( ^ )
* 非 NOT ( ~ )
* 左移 LEFT SHIFT ( << )
* 右移 RIGHT SHIFT ( >> )
* 补零右移 ZERO-FILL RIGHT SHIFT ( >>> )

这些操作符很少使用。要理解它们，我们需要深入研究底层的数字表示，而现在这样做不是最佳选择，尤其近期内不需要它们。如果您感兴趣，可以阅读MDN上的[位运算符文章](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators)。当真正需要时，这样做会更实际。

## 就地更新
我们经常需要对变量应用运算符，并将新结果存储在相同的变量中。
```javascript
let n = 2;
n = n + 5;
n = n * 2;
```

可以使用`+=` 和 `*=`来简写：
```javascript
let n = 2;
n += 5; // 现在 n = 7 (和n = n + 5一样)
n *= 2; // 现在 n = 14 (和n = n * 2一样)

alert( n ); // 14
```

短的“更新并赋值”操作符存在于所有算术运算符和位运算符中：`/=`, `-=`,等等。
这些操作符和普通的赋值优先级一样，所以他们在大部分运算之后才执行：
```javascript
let n = 2;

n *= 3 + 5;

alert( n ); // 16  (先执行右边的部分, 等于 n *= 8)
```

## 逗号
逗号运算符是最罕见、最不寻常的运算符之一。有时候，它被用来写更短的代码，所以我们需要知道它以便理解发生了什么。
逗号运算符允许我们对几个表达式求值，并用逗号将它们除去。它们中的每一个都被求值，但是只返回最后一个的结果。
```javascript
let a = (1 + 2, 3 + 4);

alert( a ); // 7 (3 + 4的结果)
```

这里第一个表达式1+2执行了，但是结果被丢弃，然后执行3+4并返回3+4的结果。

<div class="tip">
请注意，逗号运算符的优先级特别低，比`=`还低，所以上面的例子中括号很重要。
<p>
没有括号的话，a = 1 + 2, 3 + 4会先求和，变成a = 3, 7,然后赋值`a = 3`，最终逗号后面的数字7，因为没有处理被丢弃。
</p>
</div>

为什么我们需要一个操作符来丢弃除了最后一个之外的所有值呢？
比如：
```javascript
// 一行三个操作
for (a = 1, b = 3, c = a * b; a < 10; a++) {
 ...
}
```

许多JavaScript框架都使用了这种技巧。这就是我们提到它们的原因。但是，通常，它们并不能提高代码的可读性，所以我们应该在使用它们之前好好考虑一下。
