---
title: Web动画之AE+Bodymovin
date: 2019-03-28 10:46:58
tags: 动画
categories: 动画
---

## 需求背景
做一个故宫相关的活动，有3个图片素材要动态配置到页面中。其中有两个是动图，最大的超过1M。

## 业务背景
要实现上面的需求，现在的业务框架支持这么做：
1、设计提供素材图片，由于有动图，为了缩小图片大小，从原来的gif改成webp，不过依然很大；
2、运营从后台管理页面上传3个图片素材；
3、服务端将对应的素材地址返回给前端；
4、前端通过服务端给的地址实时获取图片资源，从而出现流量的一系列问题。

## AE+Bodymovin
为了解决上面出现的流量问题，我调研了AE+Bodymovin的动效模式。

### AE+Bodymovin简介
设计通过AE设计动效，安装Bodymovin插件后，直接导出js或者json数据给前端。前端利用设计提供的动画数据即可实现动效。

### 设计
设计首先需要[下载Bodymovin插件](http://aescripts.com/bodymovin/)。
具体的设计细节这里就不描述了，交给设计同事就好。
需要注意的是：
1、文件
如果使用了图片资源或者未转成形状图层的Adobe Illustrator文件图层, 将会同时生成一个images文件夹存放这些图片资源。(建议将AI图层转换为形状图层，这样他们会被导出为矢量数据，只需在AE中导入的AI图层上右键 > 从矢量图层创建形状)
<div class="tip">
注意，如果不同的带图片资源的动画导出到同一地址，images文件夹将会被覆盖。
</div>
2、性能
Bodymovin的动画都是实时渲染的，最好控制下AE工程文件体积。避免这种情况：绘制了一个巨大的形状图层，但是只通过遮罩使用其中一小部分。
过多的节点同样会影响性能。

Bodymovin支持的AE特性：
* 支持预合成、形状图层、固态层、图片、空对象以及文字图层。
* 支持遮罩和反向遮罩。也许别的模式也会支持，但是会对性能造成巨大影响。
* 支持时间重映射。
* 支持形状图层的形状、矩形、椭圆和星形。
* 支持滑块效果。
* 支持部分表达式。更多介绍可以查看[这里](https://github.com/airbnb/lottie-web/wiki/Expressions)。
* 不支持： 图像序列、视频和音频。
* 不要伸缩图层！不知为何，伸缩图层会破坏导出的数据，所以不要做这个操作。

### 前端
1、安装

```bash
npm install lottie-web
```

或者直接从[官方CDN](https://cdnjs.com/libraries/bodymovin)获取。

完整版支持渲染为svg\canvas\html三种格式，由于我们只需要svg格式（html格式性能不好，canvas格式性能够好，但是动画数据是js格式，有安全隐患，折中选择json格式数据的svg），所以只需要lottie_svg.min.js，经过gzip压缩的库文件只有48.3k。

2、demo
请看[demo](https://codepen.io/collection/nVYWZR/)。
请看[官方文档](https://github.com/airbnb/lottie-web?tdsourcetag=s_pctim_aiomsg)。

### 后端
目前的管理后台只支持上传图片（比如png、jpg、gif、webp格式），现在需要支持上传json，AE导出的数据包除了json文件，可能还有png或者jpg的静态图片，接口需要一并支持。

### 产品
1、可以较低成本配置小动图（比如，故宫活动最大的图有1M，现在只需要库文件48.3k和json文件，json文件一般不超过200k），由于数据大多是矢量数据，所以活动图可以做大却没有增加流量，相比之前图的大小，同样的流量可以做更多的图。
2、开发成本低，只需要一次开发周期，后面只需要设计提供素材（json格式的动画数据文件和最好没有的静态图片），运营直接上传。

简单说，活动图可以做大做多了。这将直接提升用户交互率。
